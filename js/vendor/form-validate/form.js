import{Validator}from"./validator.js";import{callbacks}from"./callback.js";import{initPhoneInput}from"./init-phone-input.js";export class Form{constructor(){this._validator=new Validator,this._initPhoneInput=initPhoneInput,this._callbacks=callbacks,this._validState=!1}_resetSelect(t){const e=t.querySelector("select"),a=e.options.selectedIndex,i=e.options[a],s=t.querySelector(".custom-select__text"),r=t.querySelectorAll(".custom-select__item");s.textContent=i.textContent,r.forEach(((t,e)=>{e!==a-1?t.setAttribute("aria-selected","false"):t.setAttribute("aria-selected","true")})),e.value||(t.classList.remove("not-empty"),t.classList.remove("is-valid"))}_resetSelects(t){t.querySelectorAll("[data-select]").forEach((t=>{this._resetSelect(t)}))}reset(t){this._validator._reset();const e=t.closest("[data-form-validate]");t.reset(),t.querySelectorAll(".is-invalid").forEach((t=>t.classList.remove("is-invalid"))),t.querySelectorAll(".is-valid").forEach((t=>t.classList.remove("is-valid"))),t.querySelectorAll(".input-message").forEach((t=>t.remove())),e.querySelectorAll(".input-message").forEach((t=>t.remove())),setTimeout((()=>{this._resetSelects(t)}))}initPhoneInput(t){this._initPhoneInput(t)}validateForm(t){return this._validator.validateForm(t)}validateFormElement(t){return this._validator.validateFormElement(t)}createStates(t){return this._validator._createStates(t)}_onFormSubmit(t,e=null){if(this._validState=this.validateForm(t),this._validState&&e)return this._callbacks[e].successCallback(t),void(this._callbacks[e].reset&&setTimeout((()=>{this.reset(t.target)}),this._callbacks[e].resetTimeout?this._callbacks[e].resetTimeout:500));this._validState||!e||this._callbacks[e].errorCallback(t)}_onFormInput(t){this.validateFormElement(t),this.createStates(t)}_initValidate(t){const e=t.querySelector("form");if(!e)return;e.querySelectorAll('[data-validate-type="phone"]').forEach((t=>this._initPhoneInput(t)));const a=t.dataset.callback;e.noValidate=!0,e.addEventListener("submit",(t=>{this._onFormSubmit(t,a)})),e.addEventListener("input",(t=>{this._onFormInput(t.target)})),e.addEventListener("reset",(t=>{this.reset(t.target)}))}init(){this._validateParent=document.querySelectorAll("[data-form-validate]"),this._validateParent.length&&this._validateParent.forEach((t=>this._initValidate(t)))}}